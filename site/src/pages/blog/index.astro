---
import Page from '../../layouts/page/Page.astro';
import Card from '../../components/card/Card.astro';
import { getCollection } from 'astro:content';
import FormattedDate from '../../components/formatted-date/FormattedDate.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';
import { Image } from 'astro:assets';
import searchIcon from '../../assets/icons/search.svg';

const posts = (await getCollection('blog')).sort(
	(a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf()
);
---

<Page className="blog-page" title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <div class="blog-title">
    <h1>Posts</h1>
    <div class="input">
      <Image src={searchIcon} width={14} height={14} alt="Search icon" id="input-search" />
      <input placeholder="Search posts..." id="input-element" />
    </div>
  </div>

  <div class="posts-container">
    {
      posts.map((post) => (
        <Card imgSrc={post.data.heroImage ?? ''}
              title={post.data.title}
              href={`/blog/${post.slug}`}>
          <FormattedDate date={post.data.pubDate} />
          <p>{post.data.description}</p>
        </Card>
      ))
    }
  </div>
</Page>

<style lang="scss">
  @use '../../styles/pages/Blog.scss' as *;

  .blog-page {
    @include blog-page-styles();
  }
</style>

<script>
  const inputEl = document.getElementById("input-element") as HTMLInputElement;
  const inputSearchEl = document.getElementById("input-search") as HTMLImageElement;

  inputSearchEl.onclick = () => {
    inputEl.focus();
  }

  inputEl.onfocus = () => {
    inputEl.parentElement!.classList.add('focused');
  }

  inputEl.onblur = () => {
    inputEl.parentElement!.classList.remove('focused');
  }
</script>